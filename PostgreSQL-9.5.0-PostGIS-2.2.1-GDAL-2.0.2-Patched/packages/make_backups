#!/usr/bin/env python
# coding=UTF-8

from subprocess import call
import os
import sys
import datetime

# Run psql scripts
dbs = os.environ["BACKUP_DB"].split(";")
encoding = os.environ["ENCODING"]
folder = os.environ["POSTGRES_BACKUPS_FOLDER"]
hostname = os.environ["HOSTNAME"]

# Take arguments if there are present
if len(sys.argv)>1:
    dbs = sys.argv[1:]

if dbs!=["null"]:
    for db in dbs:
        prefix = datetime.datetime.now().isoformat().replace(":","_").replace(".","_")
        call([
            "pg_dump",
            "-b",
            "-E", encoding,
            "-f", folder+"/"+hostname+"-"+prefix+"-"+db+".backup",
            "-F", "c",
            "-v",
            "-Z", "9",
            "-h", "localhost",
            "-p", "5432",
            "-U", "postgres",
            db
            ])
